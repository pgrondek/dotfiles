#!/usr/bin/env bash

GTK_THEME='Yaru-blue-dark'

if [[ "$DESKTOP_SESSION" = "dwm"  || "$DESKTOP_SESSION" == "dwm-gnome" ]]; then
    export _JAVA_AWT_WM_NONREPARENTING=1
    export AWT_TOOLKIT=MToolkit
    wmname LG3D

    picom -b
    dwmstatus &
    dunst &
    numlockx on &
    nm-applet &
    battery-watch &

    if command -v barrier &> /dev/null ; then
       barrier &
    fi

    if command -v blueman-applet &> /dev/null ; then
       blueman-applet &
    fi

    # Audio
    if command -v pasystray &> /dev/null ; then
        pasystray &
    fi

    if command -v nextcloud &> /dev/null ; then
        nextcloud --background &
    fi
    
    if command -v signal-desktop &> /dev/null ; then
        signal-desktop --start-in-tray &
    fi

    if command -v steam &> /dev/null ; then
        steam -silent &
    fi

    if command -v jetbrains-toolbox &> /dev/null ; then
        jetbrains-toolbox --minimize &
    fi

    # Authentication agent for running application as root
    if test /usr/lib/policykit-1-gnome/polkit-gnome-authentication-agent-1 ; then
        /usr/lib/policykit-1-gnome/polkit-gnome-authentication-agent-1 &
    fi

    # Deja duplicty backup monitor
    if test /usr/libexec/deja-dup/deja-dup-monitor ; then
        /usr/libexec/deja-dup/deja-dup-monitor &
    fi

    # Set background
    if test -f /usr/share/backgrounds/Mirror_by_Uday_Nakade.jpg; then
        feh --bg-scale /usr/share/backgrounds/Mirror_by_Uday_Nakade.jpg &
    elif test -f /usr/share/backgrounds/brad-huchteman-stone-mountain.jpg ; then
        feh --bg-scale /usr/share/backgrounds/brad-huchteman-stone-mountain.jpg &
    elif test -f /usr/share/backgrounds/gnome/Road.jpg ; then
        feh --bg-scale /usr/share/backgrounds/gnome/Road.jpg &
    fi

    # Add redshift
    redshift -c ${HOME}/.config/redshift.conf &
fi

[[ -f ~/.Xmodmap ]] && xmodmap ~/.Xmodmap

if test -f ${HOME}/.xsessionrc-local ; then
    ${HOME}/.xsessionrc-local
fi
