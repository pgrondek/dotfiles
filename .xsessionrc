#!/usr/bin/env bash

if [[ "$DESKTOP_SESSION" = "dwm" ]]; then
    export _JAVA_AWT_WM_NONREPARENTING=1
    export AWT_TOOLKIT=MToolkit
    wmname LG3D

    picom -b
    redshift &
    dwmstatus &
    dunst &
    numlockx on &

    if command -v blueman-applet &> /dev/null ; then
       blueman-applet &
    fi

    # Audio
    if command -v pasystray &> /dev/null ; then
        pasystray &
    fi

    if command -v nextcloud &> /dev/null ; then
        nextcloud --background &
    fi
    
    if command -v signal-desktop &> /dev/null ; then
        signal-desktop --start-in-tray &
    fi

    if command -v steam &> /dev/null ; then
        steam -silent &
    fi

    # Bluetooth 
    if command -v jetbrains-toolbox &> /dev/null ; then
        jetbrains-toolbox --minimize &
    fi

    # Authentication agent for running application as root
    if test /usr/lib/policykit-1-gnome/polkit-gnome-authentication-agent-1 ; then
        /usr/lib/policykit-1-gnome/polkit-gnome-authentication-agent-1 &
    fi

    # Deja duplicty backup monitor
    if test /usr/libexec/deja-dup/deja-dup-monitor ; then
        /usr/libexec/deja-dup/deja-dup-monitor &
    fi

    # Set background
    if test -f /usr/share/backgrounds/Mirror_by_Uday_Nakade.jpg; then
        feh --bg-scale /usr/share/backgrounds/Mirror_by_Uday_Nakade.jpg &
    elif test -f /usr/share/backgrounds/brad-huchteman-stone-mountain.jpg ; then
        feh --bg-scale /usr/share/backgrounds/brad-huchteman-stone-mountain.jpg &
    elif test -f /usr/share/backgrounds/gnome/Road.jpg ; then
        feh --bg-scale /usr/share/backgrounds/gnome/Road.jpg &
    fi
fi

if test - f ${HOME}/.xsessionrc-local ; then
    ${HOME}/.xsessionrc-local
fi
